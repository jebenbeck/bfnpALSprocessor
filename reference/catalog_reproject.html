<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Reproject lascatalog — catalog_reproject • bfnpALSprocessor</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reproject lascatalog — catalog_reproject"><meta name="description" content="Transforms the coordinate system of a lascatalog using sf::st_transform().
Hereby, all files will be transformed seperately and the catalog structure will not be touched.
While this function can transform from and to any horizontal coordinate system implemented in sf::st_transform(), it is specialized on converting point cloud data stored
in GK4 - EPSG:31468 to UTM32N - EPSG:25832.
The focus on this transformation is based on the fact, that most of the ALS data acquired in the BFNP before 2018 is stored in GK4, as it was the default reference system back then.
As the new standard is UTM32N, all data has to be transformed in order perform time series analysis more easily.
There are many different methods to transform coordinates between GK4 and UTM32N, the most accurate one is the &quot;Beta2007&quot; method
which relies on a transformation grid to change the geodetic datum. When checking the accuracy of the methods using reference points
from the bavarian surveying agency, it could be found that the accuracy went from 0.22 m in x and 0.12 m in y direction (median)
when using the default method to 0.02 m (median) in x and y direction when using the Beta2007 grid. Therefore, when transforming ALS data,
this method shall be used and this function makes it possible to to so.
Base lidR uses a ported version of sf::st_transform() in which always uses the default option, which is not Beta2007 for
transformations between GK4 and UTM32N. This leads to shifts of upt to 1 m in the point cloud datasets. However, there is a workaround to
manually make the Beta2007 method the default one and therefore use it in lidR.
To do so, the system has to be prepared by setting up some prerequisites and some basic concepts need to be understood:
To transform coordinates with sf::st_transform() it relies on the PROJ library.
It uses pipelines to define the exact transformation method that should be used.
Transformation grids to change the geodetic datum can be implemented into the pipelines using NTv2 grid datasets.
The different transformation pipelines can be observed by calling options &amp;lt;- sf_proj_pipelines(source_crs = &quot;EPSG:31468&quot;, target_crs = &quot;EPSG:25832&quot;) and then looking at options via View(options).
Hereby, the first entry is the one that will be used to transform the data. Usually, this is not the Beta2007 method so we have to make it that.
In order to use grid-based transformations, sf::st_transform() needs to have access to the grid file in .tif format.
There are two options to make that work:
accessing the file through the web via PROJ.org Datumgrid CDN
downloading the file and putting it into your local library
To make it usable as the lidR default method, we actually have to set up both. In know it's weird but it is what it is.


Enabling the web-service can be done by calling sf_proj_network(enable = T). Afterwards, check, which method is default by calling
options &amp;lt;- sf_proj_pipelines(source_crs = &quot;EPSG:31468&quot;, target_crs = &quot;EPSG:25832&quot;) and then looking at options again. The following definition entry should be on top:
+proj=pipeline +step +inv +proj=tmerc +lat_0=0 +lon_0=12 +k=1 +x_0=4500000 +y_0=0 +ellps=bessel +step +proj=hgridshift +grids=de_adv_BETA2007.tif +step +proj=utm +zone=32 +ellps=GRS80
That's already great! However, for some reason, lidR requires the grid to be available offline so we have to download the file from PROJ.org Datumbgrid CDN
and store it in the local PROJ library folder which can be found by calling sf::sf_proj_search_paths(). In my case it was &quot;C:/Users/username/AppData/Local/R/win-library/4.4/sf/proj&quot;.
After doing that for the first time, R needs to be restarted to apply these changes.
You only need to set up this once on your system, afterwards the code will work properly. The function will check for you if the settings are okay and the grid file exists at the correct place."><meta property="og:description" content="Transforms the coordinate system of a lascatalog using sf::st_transform().
Hereby, all files will be transformed seperately and the catalog structure will not be touched.
While this function can transform from and to any horizontal coordinate system implemented in sf::st_transform(), it is specialized on converting point cloud data stored
in GK4 - EPSG:31468 to UTM32N - EPSG:25832.
The focus on this transformation is based on the fact, that most of the ALS data acquired in the BFNP before 2018 is stored in GK4, as it was the default reference system back then.
As the new standard is UTM32N, all data has to be transformed in order perform time series analysis more easily.
There are many different methods to transform coordinates between GK4 and UTM32N, the most accurate one is the &quot;Beta2007&quot; method
which relies on a transformation grid to change the geodetic datum. When checking the accuracy of the methods using reference points
from the bavarian surveying agency, it could be found that the accuracy went from 0.22 m in x and 0.12 m in y direction (median)
when using the default method to 0.02 m (median) in x and y direction when using the Beta2007 grid. Therefore, when transforming ALS data,
this method shall be used and this function makes it possible to to so.
Base lidR uses a ported version of sf::st_transform() in which always uses the default option, which is not Beta2007 for
transformations between GK4 and UTM32N. This leads to shifts of upt to 1 m in the point cloud datasets. However, there is a workaround to
manually make the Beta2007 method the default one and therefore use it in lidR.
To do so, the system has to be prepared by setting up some prerequisites and some basic concepts need to be understood:
To transform coordinates with sf::st_transform() it relies on the PROJ library.
It uses pipelines to define the exact transformation method that should be used.
Transformation grids to change the geodetic datum can be implemented into the pipelines using NTv2 grid datasets.
The different transformation pipelines can be observed by calling options &amp;lt;- sf_proj_pipelines(source_crs = &quot;EPSG:31468&quot;, target_crs = &quot;EPSG:25832&quot;) and then looking at options via View(options).
Hereby, the first entry is the one that will be used to transform the data. Usually, this is not the Beta2007 method so we have to make it that.
In order to use grid-based transformations, sf::st_transform() needs to have access to the grid file in .tif format.
There are two options to make that work:
accessing the file through the web via PROJ.org Datumgrid CDN
downloading the file and putting it into your local library
To make it usable as the lidR default method, we actually have to set up both. In know it's weird but it is what it is.


Enabling the web-service can be done by calling sf_proj_network(enable = T). Afterwards, check, which method is default by calling
options &amp;lt;- sf_proj_pipelines(source_crs = &quot;EPSG:31468&quot;, target_crs = &quot;EPSG:25832&quot;) and then looking at options again. The following definition entry should be on top:
+proj=pipeline +step +inv +proj=tmerc +lat_0=0 +lon_0=12 +k=1 +x_0=4500000 +y_0=0 +ellps=bessel +step +proj=hgridshift +grids=de_adv_BETA2007.tif +step +proj=utm +zone=32 +ellps=GRS80
That's already great! However, for some reason, lidR requires the grid to be available offline so we have to download the file from PROJ.org Datumbgrid CDN
and store it in the local PROJ library folder which can be found by calling sf::sf_proj_search_paths(). In my case it was &quot;C:/Users/username/AppData/Local/R/win-library/4.4/sf/proj&quot;.
After doing that for the first time, R needs to be restarted to apply these changes.
You only need to set up this once on your system, afterwards the code will work properly. The function will check for you if the settings are okay and the grid file exists at the correct place."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bfnpALSprocessor</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Process-2023-07-ALS-data.html">Process 2023-07 ALS data</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jebenbeck/bfnpALSprocessor/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Reproject lascatalog</h1>
      <small class="dont-index">Source: <a href="https://github.com/jebenbeck/bfnpALSprocessor/blob/main/R/catalog_reproject.R" class="external-link"><code>R/catalog_reproject.R</code></a></small>
      <div class="d-none name"><code>catalog_reproject.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Transforms the coordinate system of a lascatalog using <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">sf::st_transform()</a></code>.
Hereby, all files will be transformed seperately and the catalog structure will not be touched.</p>
<p>While this function can transform from and to any horizontal coordinate system implemented in <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">sf::st_transform()</a></code>, it is specialized on converting point cloud data stored
in <a href="https://epsg.io/31468" class="external-link">GK4 - EPSG:31468</a> to <a href="https://epsg.io/25832" class="external-link">UTM32N - EPSG:25832</a>.
The focus on this transformation is based on the fact, that most of the ALS data acquired in the BFNP before 2018 is stored in GK4, as it was the default reference system back then.
As the new standard is UTM32N, all data has to be transformed in order perform time series analysis more easily.</p>
<p>There are many different methods to transform coordinates between GK4 and UTM32N, the most accurate one is the "Beta2007" method
which relies on a transformation grid to change the geodetic datum. When checking the accuracy of the methods using reference points
from the bavarian surveying agency, it could be found that the accuracy went from 0.22 m in x and 0.12 m in y direction (median)
when using the default method to 0.02 m (median) in x and y direction when using the Beta2007 grid. Therefore, when transforming ALS data,
this method shall be used and this function makes it possible to to so.</p>
<p>Base <code>lidR</code> uses a ported version of <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">sf::st_transform()</a></code> in which always uses the default option, which is not Beta2007 for
transformations between GK4 and UTM32N. This leads to shifts of upt to 1 m in the point cloud datasets. However, there is a workaround to
manually make the Beta2007 method the default one and therefore use it in <code>lidR</code>.</p>
<p>To do so, the system has to be prepared by setting up some prerequisites and some basic concepts need to be understood:</p>
<p>To transform coordinates with <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">sf::st_transform()</a></code> it relies on the <a href="https://proj.org/en/stable" class="external-link">PROJ library</a>.
It uses <a href="https://proj.org/en/stable/usage/transformation.html#transformation-pipelines" class="external-link">pipelines</a> to define the exact transformation method that should be used.
Transformation grids to change the geodetic datum can be implemented into the pipelines using <a href="https://proj.org/en/stable/usage/transformation.html#grid-based-datum-adjustments" class="external-link">NTv2 grid datasets</a>.
The different transformation pipelines can be observed by calling <code>options &lt;- sf_proj_pipelines(source_crs = "EPSG:31468", target_crs = "EPSG:25832")</code> and then looking at <code>options</code> via <code>View(options)</code>.
Hereby, the first entry is the one that will be used to transform the data. Usually, this is not the Beta2007 method so we have to make it that.</p>
<p>In order to use grid-based transformations, <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">sf::st_transform()</a></code> needs to have access to the grid file in <code>.tif</code> format.
There are two options to make that work:</p><ol><li><p>accessing the file through the web via <a href="https://cdn.proj.org/" class="external-link">PROJ.org Datumgrid CDN</a></p></li>
<li><p>downloading the file and putting it into your local library
To make it usable as the <code>lidR</code> default method, we actually have to set up both. In know it's weird but it is what it is.</p></li>
</ol><p>Enabling the web-service can be done by calling <code>sf_proj_network(enable = T)</code>. Afterwards, check, which method is default by calling
<code>options &lt;- sf_proj_pipelines(source_crs = "EPSG:31468", target_crs = "EPSG:25832")</code> and then looking at <code>options</code> again. The following definition entry should be on top:</p>
<p><code>+proj=pipeline +step +inv +proj=tmerc +lat_0=0 +lon_0=12 +k=1 +x_0=4500000 +y_0=0 +ellps=bessel +step +proj=hgridshift +grids=de_adv_BETA2007.tif +step +proj=utm +zone=32 +ellps=GRS80</code></p>
<p>That's already great! However, for some reason, <code>lidR</code> requires the grid to be available offline so we have to download the file from <a href="https://cdn.proj.org/de_adv_BETA2007.tif" class="external-link">PROJ.org Datumbgrid CDN</a>
and store it in the local PROJ library folder which can be found by calling <code><a href="https://r-spatial.github.io/sf/reference/proj_tools.html" class="external-link">sf::sf_proj_search_paths()</a></code>. In my case it was <code>"C:/Users/username/AppData/Local/R/win-library/4.4/sf/proj"</code>.
After doing that for the first time, R needs to be restarted to apply these changes.</p>
<p>You only need to set up this once on your system, afterwards the code will work properly. The function will check for you if the settings are okay and the grid file exists at the correct place.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">catalog_reproject</span><span class="op">(</span></span>
<span>  <span class="va">lascatalog</span>,</span>
<span>  <span class="va">input_epsg</span>,</span>
<span>  <span class="va">output_epsg</span>,</span>
<span>  <span class="va">output_path</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-lascatalog">lascatalog<a class="anchor" aria-label="anchor" href="#arg-lascatalog"></a></dt>
<dd><p>Object of class <code>lascatalog</code></p></dd>


<dt id="arg-input-epsg">input_epsg<a class="anchor" aria-label="anchor" href="#arg-input-epsg"></a></dt>
<dd><p>character featuring EPSG definition in the style of "EPSG:31468".</p></dd>


<dt id="arg-output-epsg">output_epsg<a class="anchor" aria-label="anchor" href="#arg-output-epsg"></a></dt>
<dd><p>character featuring EPSG definition in the style of "EPSG:31468".</p></dd>


<dt id="arg-output-path">output_path<a class="anchor" aria-label="anchor" href="#arg-output-path"></a></dt>
<dd><p>character featuring the output path where the transformed laz files will be written to.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>logical of length 1. Should the computation be split over several cores? Defaults to FALSE.</p></dd>


<dt id="arg-n-cores">n_cores<a class="anchor" aria-label="anchor" href="#arg-n-cores"></a></dt>
<dd><p>numeric of length 1. If <code>parall = TRUE</code>, on how many cores should the computations be run on?
Defaults to the value registered in <code>options("cores")[[1]]</code>, or, if this is not available, to <code>parallel::detectCores())</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>lascatalog object (laz format on disk)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>

    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jakob Ebenbeck.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

